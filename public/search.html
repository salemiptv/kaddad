<!DOCTYPE html>
<html lang="ar"> <!-- إضافة السمة lang -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- تعديل viewport -->
    <title>البحث عن الرحلات</title> <!-- تأكد من وجود عنوان للصفحة -->
    <link rel="stylesheet" href="styles.css"> <!-- تأكد من وجود ملف CSS -->
    <style>
        body {
            font-family: Arial, sans-serif; /* نوع الخط */
            background-color: #f4f4f4; /* لون خلفية الصفحة */
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center; /* مركز الصفحة أفقياً */
            align-items: center; /* مركز الصفحة عمودياً */
            height: 100vh; /* ارتفاع الصفحة */
            text-align: center; /* محاذاة النص في المنتصف */
        }

        .container {
            background-color: white; /* لون خلفية الحاوية */
            padding: 20px; /* مساحة داخل الحاوية */
            border-radius: 8px; /* زوايا دائرية للحاوية */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* ظل */
            width: 90%; /* عرض مناسب للهواتف */
            max-width: 400px; /* عرض ثابت للأجهزة الكبيرة */
        }

        h1 {
            margin-bottom: 20px; /* مسافة أسفل العنوان */
        }

        label {
            display: block; /* جعل العلامات ككتل */
            margin-bottom: 5px; /* إضافة مسافة أسفل العلامة */
            text-align: right; /* محاذاة النص لليمين */
        }

        select, button {
            width: 100%; /* العرض الكامل للمكونات */
            padding: 10px; /* مساحة داخلية */
            border: 1px solid #ccc; /* لون الحدود */
            border-radius: 4px; /* زوايا دائرية */
            margin-bottom: 15px; /* إضافة مسافة بين العناصر */
            box-sizing: border-box; /* تأكد من أن padding لا يؤثر على العرض */
        }

        button {
            background-color: #4CAF50; /* لون زر البحث */
            color: white; /* لون نص الزر */
            border: none; /* إزالة الحدود */
            cursor: pointer; /* تغيير شكل المؤشر عند المرور فوق الزر */
        }

        button:hover {
            background-color: #45a049; /* تغيير لون الزر عند المرور عليه */
        }

        #tripsContainer {
            margin-top: 20px; /* مسافة فوق حاوية الرحلات */
            text-align: left; /* محاذاة النص لليسار */
        }

        .trip {
            background-color: #f9f9f9; /* لون خلفية الرحلة */
            padding: 15px; /* مساحة داخلية للرحلة */
            margin-bottom: 15px; /* مسافة أسفل كل رحلة */
            border-radius: 4px; /* زوايا دائرية للرحلة */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); /* ظل */
        }

        .trip h3 {
            margin-top: 0; /* إزالة المسافة العلوية في عنوان الرحلة */
        }

        /* تصميم زر الدخول كمقدم خدمة */
        #provider-btn {
            background-color: #2196F3; /* لون زر الدخول كمقدم خدمة */
        }

        #provider-btn:hover {
            background-color: #1976D2; /* تغيير لون الزر عند المرور عليه */
        }

        .error-message {
            color: red; /* لون الرسالة الخطأ */
            margin-top: 20px; /* مسافة فوق رسالة الخطأ */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>البحث عن الرحلات</h1>
        <form id="searchForm">
            <label for="departure">نقطة الانطلاق:</label>
            <select id="departure" required title="اختر نقطة الانطلاق"> <!-- إضافة title -->
                <option value="">اختر نقطة الانطلاق</option>
                <option value="عمان">عمان</option>
                <option value="الزرقاء">الزرقاء</option>
                <option value="إربد">إربد</option>
                <option value="جرش">جرش</option>
                <option value="عجلون">عجلون</option>
                <option value="المفرق">المفرق</option>
                <option value="البلقاء">البلقاء</option>
                <option value="مادبا">مادبا</option>
                <option value="الكرك">الكرك</option>
                <option value="الطفيلة">الطفيلة</option>
                <option value="معان">معان</option>
                <option value="العقبة">العقبة</option>
                <!-- المزيد من المدن الأردنية إذا لزم الأمر -->
            </select>

            <label for="arrival">نقطة الوصول:</label>
            <select id="arrival" required title="اختر نقطة الوصول"> <!-- إضافة title -->
                <option value="">اختر نقطة الوصول</option>
                <option value="عمان">عمان</option>
                <option value="الزرقاء">الزرقاء</option>
                <option value="إربد">إربد</option>
                <option value="جرش">جرش</option>
                <option value="عجلون">عجلون</option>
                <option value="المفرق">المفرق</option>
                <option value="البلقاء">البلقاء</option>
                <option value="مادبا">مادبا</option>
                <option value="الكرك">الكرك</option>
                <option value="الطفيلة">الطفيلة</option>
                <option value="معان">معان</option>
                <option value="العقبة">العقبة</option>
                <!-- المزيد من المدن الأردنية إذا لزم الأمر -->
            </select>

            <button type="submit">ابحث عن الرحلات</button>
        </form>

        <div id="tripsContainer"></div>
        <div class="error-message" id="errorMessage"></div> <!-- منطقة لعرض رسالة الخطأ -->

        <!-- زر الدخول كمقدم خدمة -->
        <div style="margin-top: 20px;">
            <button id="provider-btn" onclick="window.location.href='login-provider.html'">الدخول كمقدم خدمة</button>
        </div>

        <!-- زر العودة -->
        <div style="margin-top: 20px;">
            <button onclick="goBack()">عودة</button>
        </div>
    </div>

    <script>
        document.getElementById('searchForm').addEventListener('submit', function (e) {
            e.preventDefault(); // منع إرسال النموذج بشكل افتراضي

            const departure = document.getElementById('departure').value; // الحصول على نقطة الانطلاق
            const arrival = document.getElementById('arrival').value; // الحصول على نقطة الوصول
            const errorMessage = document.getElementById('errorMessage'); // منطقة عرض رسالة الخطأ

            fetch(`/get-trips?departure=${departure}&arrival=${arrival}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok'); // معالجة الأخطاء
                    }
                    return response.json(); // تحويل البيانات إلى JSON
                })
                .then(data => {
                    const tripsContainer = document.getElementById('tripsContainer');
                    tripsContainer.innerHTML = ''; // مسح محتويات الحاوية
                    errorMessage.innerHTML = ''; // مسح رسالة الخطأ

                    if (data.success && data.trips.length > 0) {
                        data.trips.forEach(trip => {
                            const tripDiv = document.createElement('div');
                            tripDiv.classList.add('trip');
                            tripDiv.innerHTML = `
                                <h3>${trip.driverName} - ${trip.carType}</h3>
                                <p>اللون: ${trip.carColor}</p>
                                <p>نقطة الانطلاق: ${trip.departureLocation}</p>
                                <p>نقطة الوصول: ${trip.arrivalLocation}</p>
                                <p>رقم السائق: ${trip.driverPhone}</p>
                                <p>وقت الرحلة: ${trip.time}</p>
                                <p>تكلفة الرحلة: ${trip.cost} دينار</p>
                                <button onclick="bookTrip(${trip.id})">احجز الرحلة</button>
                            `;
                            tripsContainer.appendChild(tripDiv); // إضافة الرحلة إلى الحاوية
                        });
                    } else {
                        errorMessage.innerHTML = 'لا توجد رحلات متاحة.'; // رسالة إذا لم توجد رحلات
                    }
                })
                .catch(error => {
                    console.error('Error:', error); // طباعة الخطأ في وحدة التحكم
                    errorMessage.innerHTML = 'حدث خطأ أثناء البحث عن الرحلات. حاول مرة أخرى لاحقًا.'; // رسالة خطأ عامة
                });
        });

        function bookTrip(tripId) {
            fetch(`/book-trip/${tripId}`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('تم الحجز بنجاح!'); // رسالة نجاح الحجز
                } else {
                    alert('فشل الحجز. حاول مرة أخرى.'); // رسالة فشل الحجز
                }
            })
            .catch(error => {
                console.error('Error:', error); // طباعة الخطأ في وحدة التحكم
                alert('حدث خطأ أثناء محاولة الحجز.'); // رسالة خطأ عامة
            });
        }

        function goBack() {
            window.history.back(); // العودة إلى الصفحة السابقة
        }
    </script>
</body>
</html>
