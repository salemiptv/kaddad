<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إتمام الدفع</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        header {
            background-color: #333;
            color: #fff;
            padding: 10px;
            text-align: center;
        }
        .container {
            padding: 20px;
            max-width: 600px;
            margin: auto;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        button {
            margin-top: 20px;
            padding: 10px;
            border: none;
            border-radius: 5px;
            background-color: #28a745;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #218838;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <header>
        <h1>إتمام الدفع</h1>
    </header>

    <div class="container">
        <form id="payment-form">
            <!-- حقل المبلغ -->
            <label for="amount">المبلغ:</label>
            <input type="number" id="amount" name="amount" value="50" readonly>

            <!-- طريقة الدفع -->
            <label for="payment-method">طريقة الدفع:</label>
            <select id="payment-method" name="payment-method" required>
                <option value="">اختر طريقة الدفع</option>
                <option value="credit-card">بطاقة بنكية</option>
                <option value="cliq">Cliq</option>
                <option value="orange-money">Orange Money</option>
                <option value="zain-cash">Zain Cash</option>
            </select>

            <!-- تفاصيل البطاقة عند اختيار بطاقة بنكية -->
            <div id="credit-card-details" class="hidden">
                <label for="card-number">رقم البطاقة:</label>
                <input type="text" id="card-number" name="card-number" required pattern="^\d{16}$" title="رقم البطاقة يجب أن يتكون من 16 رقم.">

                <label for="expiry-date">تاريخ الانتهاء (MM/YY):</label>
                <input type="text" id="expiry-date" name="expiry-date" required pattern="^(0[1-9]|1[0-2])\/?([0-9]{2})$" title="تنسيق التاريخ: MM/YY">

                <label for="cvv">رمز التحقق (CVV):</label>
                <input type="text" id="cvv" name="cvv" required pattern="^\d{3}$" title="رمز CVV يجب أن يتكون من 3 أرقام.">
            </div>

            <!-- تفاصيل طريقة الدفع Orange Money -->
            <div id="orange-money-details" class="hidden">
                <p>حساب استقبال الأموال هو محفظة Orange رقم: 00962770288772</p>
                <label for="orange-phone">رقم الهاتف:</label>
                <input type="text" id="orange-phone" name="orange-phone" required pattern="^07\d{8}$" title="رقم الهاتف يجب أن يتكون من 10 خانات ويبدأ بـ 07">
            </div>

            <!-- تفاصيل طريقة الدفع Cliq -->
            <div id="cliq-details" class="hidden">
                <p>يرجى إدخال معلومات الدفع الخاصة بك:</p>
                <label for="cliq-code">رمز Cliq:</label>
                <input type="text" id="cliq-code" name="cliq-code" required>
            </div>

            <button type="submit">إتمام الدفع</button>
        </form>

        <!-- رابط العودة إلى الصفحة الرئيسية -->
        <div>
            <a href="index.html">العودة إلى الصفحة الرئيسية</a>
        </div>
    </div>

    <script>
        // عرض الحقول المناسبة بناءً على طريقة الدفع
        document.getElementById('payment-method').addEventListener('change', function() {
            const method = this.value;
            document.getElementById('credit-card-details').classList.add('hidden');
            document.getElementById('orange-money-details').classList.add('hidden');
            document.getElementById('cliq-details').classList.add('hidden');

            if (method === 'credit-card') {
                document.getElementById('credit-card-details').classList.remove('hidden');
            } else if (method === 'orange-money') {
                document.getElementById('orange-money-details').classList.remove('hidden');
            } else if (method === 'cliq') {
                document.getElementById('cliq-details').classList.remove('hidden');
            }
        });

        document.getElementById('payment-form').addEventListener('submit', function(event) {
            event.preventDefault();

            const amount = 50; // ثابت
            const paymentMethod = document.getElementById('payment-method').value;
            const userName = 'اسم الشخص'; // هنا يمكنك إدخال اسم الشخص الفعلي
            const userPhone = document.getElementById('orange-phone') ? document.getElementById('orange-phone').value : ''; // رقم الهاتف

            let paymentData = { amount, paymentMethod, userName, userPhone };

            // إضافة تفاصيل الدفع بناءً على الطريقة المختارة
            if (paymentMethod === 'credit-card') {
                const cardNumber = document.getElementById('card-number').value;
                const expiryDate = document.getElementById('expiry-date').value;
                const cvv = document.getElementById('cvv').value;
                paymentData.cardNumber = cardNumber;
                paymentData.expiryDate = expiryDate;
                paymentData.cvv = cvv;
            } else if (paymentMethod === 'orange-money') {
                const orangePhone = document.getElementById('orange-phone').value;
                paymentData.orangePhone = orangePhone;
            } else if (paymentMethod === 'cliq') {
                const cliqCode = document.getElementById('cliq-code').value;
                paymentData.cliqCode = cliqCode;
            }

            // إرسال بيانات الدفع إلى الخادم
            fetch('/process-payment', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(paymentData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('تم إتمام الدفع بنجاح.');
                    // إرسال تفاصيل الدفع إلى الأدمن
                    fetch('/notify-admin', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            userName,
                            userPhone,
                            amount,
                            paymentMethod
                        })
                    });

                    // يمكن إعادة توجيه المستخدم إلى صفحة نجاح أو العودة إلى الرئيسية
                    window.location.href = 'index.html';
                } else {
                    alert('فشل في إتمام الدفع: ' + data.message);
                }
            })
            .catch(error => {
                console.error('حدث خطأ:', error);
                alert('فشل في إتمام الدفع. حاول مرة أخرى.');
            });
        });
    </script>
</body>
</html>
